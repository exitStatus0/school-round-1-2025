# Лекція: **Neovim — сучасний CLI‑редактор для Linux (і не тільки)**

> Ця лекція знайомить із **Neovim (nvim)** — сучасним «Vim‑сумісним» редактором, оптимізованим для швидкості, автоматизації та розширюваності. Пояснюємо базові режими й команди (аналогічні Vim), показуємо збереження/вихід, пошук/заміни, навігацію, а також коротко торкаємось плагінів (LSP, Treesitter, Telescope) і мінімальної конфігурації **Lua**. Приклади у підказці терміналу використовують `{userName}` замість конкретного імені користувача.

---

## Навчальні цілі
Після лекції ви зможете:
- Пояснити, що таке **Neovim** і як він співвідноситься з **Vim**.
- Виконувати базові дії в **нормальному/режимі вставки**: редагування, збереження, вихід.
- Користуватися пошуком, заміною, навігацією, скасуванням/повтором змін.
- Розуміти базові **буфери/вікна/вкладки**.
- Запустити **мінімальну конфігурацію** Neovim на Lua і встановити плагіни (через `lazy.nvim`).
- Знати типові сценарії DevOps/CLI, де Neovim — найзручніший інструмент (швидкі правки конфігів, коміти Git, SSH‑сесії на серверах).

---

## План лекції
1. Що таке Neovim і чому саме він
2. Режими роботи: Normal, Insert, Visual, Command‑line
3. Базові операції з файлами: відкриття/створення, збереження, вихід
4. Корисні команди Normal‑режиму: навігація, видалення, пошук/заміна, скасування
5. Буфери, вікна, вкладки (buffers/splits/tabs)
6. Інтеграції Neovim: вбудований термінал, запуск команд оболонки
7. Установка Neovim (коротко) і мінімальна конфігурація Lua
8. Плагіни: Treesitter, LSP, Telescope (через `lazy.nvim`)
9. Практикум (15–30 хв)
10. Поширені помилки та поради
11. Контрольні питання
12. Аналогія «піаніст та синтезатор»
13. Глосарій

---

## 1) Що таке Neovim і чому саме він

- **Neovim (nvim)** — «Vim‑сумісний» редактор, що фокусується на **модернізації**: Lua‑API, асинхронність, вбудований **LSP‑клієнт**, **Treesitter**, термінал тощо.
- Переваги для щоденної роботи:
  - **Швидкість і ефективність** після освоєння жестів/команд.
  - **CLI‑орієнтованість**: ідеальний для SSH і серверів без GUI.
  - **Універсальний**: редагування коду (Python, Go, YAML, Markdown…), конфігів, коміт‑меседжів.
  - **Розширюваність**: багата екосистема плагінів, конфігурація **Lua**.
- Якщо знаєте базові прийоми Vim — **Neovim «відчувається» так само**, але з додатковими можливостями.

---

## 2) Режими роботи

- **Normal (за промовчанням):** навігація, команди, маніпуляції з текстом (видалення/копіювання/вставка), пошук тощо.
- **Insert:** введення тексту. Перемикання з Normal → Insert: натисніть **`i`** (або `a`, `o` тощо). Позначка `-- INSERT --` внизу.
- **Visual / Visual Line / Visual Block:** виділення символів (**`v`**), рядків (**`V`**), блоків (**`Ctrl+v`**).
- **Command‑line:** двокрапка **`:`** для введення команд (напр., `:w`, `:q`, `:s/.../.../`).  
  Повернення до Normal — **`Esc`**.

---

## 3) Базові операції з файлами

Відкрити існуючий або створити новий файл:
```bash
{userName}@host:~$ nvim config.yaml
```

Режими:
- Normal → Insert: **`i`** (вставка перед курсором), **`a`** (після), **`o`** (нова лінія нижче й у Insert).
- Повернутися до Normal: **`Esc`**.

Збереження/вихід (у Command‑line, тобто після `:`):
- **`:w`** — записати (save).
- **`:q`** — вийти (quit).
- **`:wq`** або **`:x`** — записати й вийти.
- **`:q!`** — вийти **без збереження**.

Корисне:
- **`:e <шлях>`** — відкрити інший файл у поточному буфері.
- **`:w <новий_файл>`** — зберегти у новий файл («Save As…»).
- **`:help`** або **`:h <тема>`** — довідка (напр., `:h :s` або `:h motion`).

---

## 4) Корисні команди Normal‑режиму

**Навігація:**
```text
h j k l      # ← ↓ ↑ → (рух курсора)
0 / ^        # початок рядка
$            # кінець рядка
gg / G       # початок / кінець файла
:<число>     # перейти на N‑й рядок (напр., :12)
w / b / e    # слово вперед / назад / кінець слова
```

**Редагування та видалення:**
```text
x            # видалити символ під курсором
dd           # видалити (вирізати) поточний рядок
D / d$       # видалити до кінця рядка
cc / S       # змінити (замінити) весь рядок
u            # скасувати (undo)
Ctrl+r       # повторити (redo)
p / P        # вставити після / перед курсором
```

**Пошук і заміна:**
```text
/<шаблон>    # пошук вперед
n / N        # наступний / попередній збіг
:%s/old/new/g         # замінити всі входження у файлі
:%s/old/new/gc        # те саме з підтвердженням (confirm)
```

Порада: у Neovim зазвичай доступне **підсвічування синтаксису**, розумні відступи тощо (за замовчуванням або з плагінами).

---

## 5) Буфери, вікна, вкладки

- **Буфер** — відкритий файл у пам’яті.
- **Вікно (split)** — «панель», що показує буфер. Можна мати кілька вікон поруч.
- **Вкладка (tab)** — набір вікон.

Команди:
```text
:ls              # список буферів
:b <nr|pattern>  # перейти до буфера
:sp / :vsp       # горизонтальний / вертикальний split
Ctrl+w s / v     # те саме клавішами
Ctrl+w h/j/k/l   # переміщення між вікнами
:tabnew          # нова вкладка
:tabn / :tabp    # наступна / попередня вкладка
```

---

## 6) Інтеграції Neovim

- **Вбудований термінал:** `:terminal` або коротко `:term`. Вихід у Normal: `Ctrl+\` потім `Ctrl+n`.
- **Запуск команд оболонки:** `:!ls`, `:!pytest`, `:!kubectl get pods` — зручно для швидких перевірок.
- **Мод є без конфігів:** `nvim -u NONE` або чистий режим `nvim --clean` (для діагностики конфіга/плагінів).

---

## 7) Установка Neovim (коротко)

```bash
# Debian/Ubuntu
sudo apt update && sudo apt install -y neovim

# Fedora/RHEL
sudo dnf install -y neovim

# Arch
sudo pacman -S neovim
```

> Порада: На робочих серверах часто достатньо системного пакету. На локальній машині інколи хочеться новішу версію — встановлюйте з офіційних пакетів вашого дистрибутива або використовуйте готові збірки (за потреби).

---

## 8) Мінімальна конфігурація Lua + плагіни (`lazy.nvim`)

Файли конфігурації Neovim (Linux): **`~/.config/nvim/init.lua`**.  
Приклад **мінімальної** конфігурації з базовими налаштуваннями та менеджером плагінів **lazy.nvim**:

```lua
-- ~/.config/nvim/init.lua

-- 1) Базові опції
vim.opt.number = true
vim.opt.relativenumber = true
vim.opt.expandtab = true
vim.opt.shiftwidth = 2
vim.opt.tabstop = 2
vim.opt.clipboard = "unnamedplus"   -- спільний буфер обміну з ОС (за підтримки)

-- 2) Лідер‑клавіша для зручних мапінгів
vim.g.mapleader = " "

-- 3) Bootstrap lazy.nvim (якщо ще не встановлено)
local lazypath = vim.fn.stdpath("data") .. "/lazy/lazy.nvim"
if not vim.loop.fs_stat(lazypath) then
  vim.fn.system({
    "git",
    "clone",
    "--filter=blob:none",
    "https://github.com/folke/lazy.nvim.git",
    "--branch=stable",
    lazypath,
  })
end
vim.opt.rtp:prepend(lazypath)

-- 4) Оголошення плагінів
require("lazy").setup({
  {"nvim-treesitter/nvim-treesitter", build = ":TSUpdate"},
  {"nvim-lua/plenary.nvim"},
  {"nvim-telescope/telescope.nvim"},
  {"neovim/nvim-lspconfig"},
  {"williamboman/mason.nvim"},
  {"williamboman/mason-lspconfig.nvim"},
  {"hrsh7th/nvim-cmp"},
  {"hrsh7th/cmp-nvim-lsp"},
  {"L3MON4D3/LuaSnip"},
})

-- 5) Просте налаштування Treesitter
require("nvim-treesitter.configs").setup({
  ensure_installed = { "lua", "bash", "python", "yaml", "markdown", "json" },
  highlight = { enable = true },
  indent = { enable = true },
})

-- 6) LSP (через mason + lspconfig)
require("mason").setup()
require("mason-lspconfig").setup({
  ensure_installed = { "lua_ls", "bashls", "pyright", "yamlls", "jsonls" },
})
local lspconfig = require("lspconfig")
local capabilities = require("cmp_nvim_lsp").default_capabilities()

for _, server in ipairs({ "lua_ls", "bashls", "pyright", "yamlls", "jsonls" }) do
  lspconfig[server].setup({ capabilities = capabilities })
end

-- 7) Автодоповнення
local cmp = require("cmp")
cmp.setup({
  mapping = cmp.mapping.preset.insert({
    ["<CR>"] = cmp.mapping.confirm({ select = true }),
    ["<C-Space>"] = cmp.mapping.complete(),
  }),
  sources = {
    { name = "nvim_lsp" },
  },
})
```

> Після першого запуску `nvim` з такою конфігурацією `lazy.nvim` сам підтягне плагіни. Для LSP‑серверів допоможе `:Mason` (інсталюйте потрібні зі списку).

---

## 9) Практикум (15–30 хв)

1. **Запустіть Neovim** і створіть файл:
   ```bash
   nvim ~/labs/nvim-demo/notes.md
   ```
2. **Режими:** введіть текст в **Insert** (`i`), поверніться в **Normal** (`Esc`).  
3. **Збереження/вихід:** `:w`, `:q`, `:wq`, `:q!`.
4. **Навігація та правки:** `gg`, `G`, `0`, `$`, `dd`, `p`, `u`, `Ctrl+r`.
5. **Пошук/заміна:** `/TODO`, `n`, `:%s/TODO/DONE/gc`.
6. **Спліти та буфери:** `:vsp notes.md`, `Ctrl+w h/l`, `:ls`, `:b <nr>`.
7. **Вбудований термінал:** `:term`, виконайте `ls`, поверніться в Normal (`Ctrl+\`, `Ctrl+n`).

> *Результат:* керуєте файлами в Neovim, вмієте зберігати, шукати/замінювати, користуватись сплітами й терміналом, розумієте основу Lua‑конфігурації.

---

## 10) Поширені помилки та поради

- **Забули вийти з Insert** — натисніть **`Esc`** для повернення в Normal.
- **`:q` не працює** через незбережені зміни — використовуйте `:wq` або `:q!`.
- **Конфігурація зламується** — запустіть `nvim -u NONE` або `--clean`, щоб діагностувати.
- **Повільний старт** — перевірте плагіни; вимкніть зайве, оновіть `lazy.nvim` та плагіни.
- **Не працює копіювання у системний буфер** — перевірте `set clipboard=unnamedplus` і наявність відповідних кліпборд‑залежностей у ОС.

---

## 11) Контрольні питання

1. Чим Neovim відрізняється від класичного Vim з точки зору розширюваності?
2. Які режими існують у Neovim і як між ними перемикатися?
3. Як зберегти зміни, вийти з файла і вийти **без збереження**?
4. Як виконати пошук і глобальну заміну у всьому файлі?
5. Що таке **буфер**, **спліт** і **вкладка** в Neovim?
6. Де знаходиться **init.lua** і за що відповідає `lazy.nvim`?

---

## 12) Аналогія: «піаніст та синтезатор»

- **Neovim** — потужний «цифровий синтезатор» у вашому терміналі.
- **Normal** — «режим налаштування»: перемикаєте інструменти, секції, керуєте структурою.
- **Insert** — «режим гри»: кожне натискання — «нота», ви «граєте» текст.
- **Esc / i** — швидкий перехід між налаштуванням і виконанням.
- **`:wq` / `:q!`** — зберегти композицію або закрити без запису.
- **Плагіни** — ефекти та модулі, що розширюють можливості «синтезатора».

---

## 13) Глосарій

- **Neovim (nvim):** сучасний Vim‑сумісний редактор із Lua‑API, LSP, Treesitter.
- **Normal/Insert/Visual/Command‑line:** основні режими роботи.
- **Buffer/Window/Tab:** модель відображення файлів у Neovim.
- **LSP (Language Server Protocol):** підказки, діагностика, переходи по коду.
- **Treesitter:** парсинг коду для підсвічування та структури.
- **Telescope:** фази‑пошук/навігація (файли, grep, буфери).
- **lazy.nvim:** сучасний менеджер плагінів.
- **`init.lua`:** головний файл конфігурації Neovim.

---

> **Короткий підсумок:** Neovim поєднує швидкість і філософію Vim із сучасними можливостями (Lua, LSP, Treesitter). Для DevOps та розробників це один із найефективніших інструментів роботи із файлами та кодом у терміналі.
