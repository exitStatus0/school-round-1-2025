# Лекція: **Основи комп’ютерних мереж для Linux**

> У цій лекції розберемо, як комп’ютери з’єднуються між собою та з Інтернетом: **LAN/WAN, IP‑адреси, підмережі (CIDR), шлюз, NAT, порти та firewall, DNS**, а також корисні мережеві команди Linux.

---

## Навчальні цілі
Після лекції ви зможете:
- Пояснити різницю між **LAN**, **WAN/Інтернетом**, ролі **комутатора** та **маршрутизатора**.
- Читати/записувати **IPv4‑адреси**, розуміти **маску** й **CIDR** (`/24`, `/16`) та визначати, чи адреса «локальна» чи «зовнішня».
- Розуміти, що таке **шлюз**, **NAT** і чому він потрібен.
- Розрізняти **порти** і як **firewall** контролює доступ.
- Пояснювати, як **DNS** перетворює доменні імена на IP‑адреси та що таке кешування.
- Використовувати базові команди Linux для діагностики мережі: `ip`, `ss`, `lsof`, `ping`, `traceroute`/`mtr`, `dig`/`nslookup` тощо.

---

## План лекції
1. LAN і IP‑адреси (IPv4/IPv6 коротко)
2. Комутатор (L2) і маршрутизатор (L3). Шлюз. ARP
3. Підмережі та CIDR. Як зрозуміти «своя мережа» чи Інтернет
4. Параметри інтерфейсу та **NAT**
5. **Firewall** і **порти**
6. **DNS**: ієрархія, запис A/AAAA, кеш
7. Корисні команди Linux (класичні й сучасні)
8. Практикум
9. Нотатки з безпеки й типові проблеми
10. Контрольні питання
11. Аналогія «місто і пошта»
12. Шпаргалка

---

## 1) LAN і IP‑адреси

- **LAN** — локальна мережа в будинку/офісі/аудиторії.
- **IPv4** має **32 біти** → 4 октети `0–255`: приклад `192.168.1.42`.
- **Приватні діапазони (RFC1918)**: `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16` — використовуються всередині LAN, **не маршрутизуються** в Інтернеті напряму.
- **IPv6** (коротко): 128 біт, запис у шістнадцятковому вигляді (напр. `2001:db8::1`). Розв’язує дефіцит адрес, має вбудовані механізми автоконфігурації.

---

## 2) Комутатор і маршрутизатор. Шлюз. ARP

- **Комутатор (Switch, L2)** з’єднує пристрої в LAN і комутує **кадри за MAC‑адресами** (не IP).  
  > Примітка: IP‑адреси використовуються на 3‑му рівні; прив’язка IP→MAC у межах LAN виконується протоколом **ARP**.
- **Маршрутизатор (Router, L3)** з’єднує різні мережі (LAN ↔ WAN/Інтернет), приймає рішення на основі **IP‑адрес**.
- **Шлюз (gateway)** — IP‑адреса маршрутизатора у вашій LAN (типово щось на кшталт `192.168.1.1`). Трафік «назовні» іде через шлюз.

**Коли пакет локальний чи зовнішній?**  
Якщо IP призначення належить вашій підмережі — кадр іде напряму в LAN (через switch). Якщо ні — пакет надсилається на **шлюз** (router).

---

## 3) Підмережі та CIDR

- **Маска** визначає, які біти IP «мережеві», а які «хостові».
  - Приклади масок: `255.255.255.0` = **/24**; `255.255.0.0` = **/16**.
- **CIDR‑нотація** `/N` — скільки **мережевих бітів** фіксовано.
  - `192.168.1.0/24` → адреси хостів: `192.168.1.1–192.168.1.254` (мережа `.0`, broadcast `.255`).
- Визначити «свою мережу»: побітово **AND** між адресою хоста та маскою → отримуємо мережеву адресу. Якщо мережеві адреси (source/destination) збігаються — призначення локальне.

---

## 4) Параметри інтерфейсу та NAT

Кожному хосту потрібні:
- **IP‑адреса**
- **маска/CIDR**
- **шлюз (gateway)**
- (зазвичай) **DNS‑сервер(и)**

**NAT (Network Address Translation)** — функція маршрутизатора, яка підміняє внутрішні приватні IP на зовнішню адресу маршрутизатора. Варіанти:
- **SNAT/PAT (маскарадинг)**: багато внутрішніх адрес → один зовнішній IP (через різні порти). Безпечніше і економить IPv4.
- **DNAT/порт‑форвардинг**: зовнішні з’єднання спрямовуються на конкретний внутрішній хост/порт.

Плюси NAT:
- **Приховує** внутрішню адресацію
- Дозволяє багато LAN використовувати однакові приватні діапазони
- Економить публічні IPv4

---

## 5) Firewall і порти

- **Порт** — «двері» застосунку: **TCP/UDP** 0–65535.  
  Типові: `80` (HTTP), `443` (HTTPS), `22` (SSH), `5432` (PostgreSQL), `3306` (MySQL).
- На одному IP **неможливо** запустити дві програми, що **слухають** **один і той самий порт/протокол**.
- **Firewall** (на хості або на периметрі) визначає, що **дозволено/заборонено** (вхід/вихід).  
  У Linux: **nftables** (сучасно), **iptables** (класика), обгортки типу **ufw**, **firewalld**.

> Ефемерні порти (клієнтські) автоматично виділяються ОС для ініціації вихідних з’єднань.

---

## 6) DNS: імена → адреси

- **DNS** перетворює домени на IP (**A** для IPv4, **AAAA** для IPv6). Також існують записи **CNAME**, **MX**, **TXT**, **NS** тощо.
- **Ієрархія**: кореневі сервери (логічно «13» імен, фізично — багато anycast‑вузлів) → **TLD** (.com, .org, .ua, …) → **авторитетні** сервери конкретного домену.
- **Рекурсивний резолвер** (ваш провайдер/локальний кеш) запитує ланцюжком і кешує відповіді згідно **TTL**.
- **ICANN** координує простір імен; реєстратори продають домени, хостери тримають авторитетні DNS.

---

## 7) Корисні команди Linux

> Сучасні утиліти: `ip`, `ss`, `dig`, `lsof`, `mtr`. Класичні (`ifconfig`, `netstat`, `nslookup`) можуть бути відсутні або застарілі.

**Адреси/інтерфейси/шляхи:**
```bash
ip -br addr              # короткий огляд інтерфейсів і IP
ip route                 # таблиця маршрутів (дефолтний шлюз → "default via ...")
ping -c4 8.8.8.8         # перевірка мережевої досяжності по ICMP
traceroute 8.8.8.8       # шлях до вузла (або mtr 8.8.8.8)
```

**Порти/з’єднання і відповідні процеси:**
```bash
ss -ltnp                 # хто слухає TCP‑порти + PID/процес
ss -punt                 # UDP і TCP з деталями
lsof -i -P -n            # сокети + процеси (потрібні права)
```

**DNS:**
```bash
dig +short example.com A
dig +short example.com AAAA
dig example.com ANY      # загальний огляд (може бути урізаний)
nslookup example.com     # класична альтернатива
```

**Хто відповідає на порті:**
```bash
ss -ltnp | grep ':5432'  # чи слухає PostgreSQL
```

**Класичні (можуть бути відсутні):**
```bash
ifconfig                  # адреси інтерфейсів (застаріле; заміна: ip addr)
netstat -tulpen          # активні сокети (застаріле; заміна: ss)
```

> `ps` **не показує порти**; використовуйте `ss`/`lsof` і зв’яжіть PID з `ps` при потребі.

---

## 8) Практикум (20–30 хв)

1) **Визначте параметри хоста**
```bash
ip -br addr
ip route | sed -n '1p'
```
Поясніть: ваша IP‑адреса, маска (через CIDR), дефолтний шлюз.

2) **Локальне vs зовнішнє**
- Оберіть 2 адреси: одну в межах вашої підмережі, іншу — публічну. Покажіть, куди піде пакет (прямо чи через шлюз).

3) **Перевірка сервісів**
```bash
ss -ltnp        # знайдіть, що слухає 22/80/443/5432
```
Спробуйте `curl -I http://127.0.0.1:80` (якщо є локальний веб‑сервер).

4) **DNS‑діагностика**
```bash
dig +trace example.com   # побачити весь ланцюжок запитів
```

5) **Пошук «винуватця» порту**
```bash
sudo lsof -iTCP:8080 -sTCP:LISTEN -n -P
```

---

## 9) Безпека і типові проблеми

- **Неправильний `PATH` до DNS/шлюзу** → «є IP, але немає Інтернету». Перевірте `ip route`, `/etc/resolv.conf`.
- **Firewall блокує порт** → сервіс запущений, але «недоступний ззовні». Перевірте `nft/iptables`, правила хмарного фаєрвола/SG.
- **Порт зайнятий** → інший процес уже слухає. Перевірте `ss`/`lsof`.
- **NAT і порт‑форвардинг** → вхідні ззовні не доходять без DNAT/пробросу портів.
- **DNS кеш/TTL** → зміни домену «не бачаться» відразу; очистіть кеш або зачекайте TTL.

---

## 10) Контрольні питання

1. Чому комутатор працює з **MAC**, а визначення «сусіда за IP» робить **ARP**?
2. Що означає `192.168.10.0/24` і скільки адрес доступно для хостів?
3. Як ОС вирішує — відправляти пакет напряму чи на шлюз?
4. Навіщо потрібен **NAT** і чим відрізняються **SNAT** та **DNAT**?
5. Чому дві програми не можуть слухати один і той самий **порт/протокол** на одному IP?
6. Чим відрізняються записи **A** і **AAAA**? Де кешується DNS‑відповідь?
7. Якими командами знайти: (а) IP і шлюз; (б) хто слухає порт 5432; (в) IP домену `example.com`?

---

## 11) Аналогія: «місто і пошта»

- **LAN** — ваш квартал; **WAN/Інтернет** — інші міста/країни.
- **IP‑адреса** — адреса будинку; **MAC** — «серійний номер дверей».
- **Комутатор** — листоноша всередині кварталу; **маршрутизатор/шлюз** — центральна поштова станція.
- **NAT** — відправляє пошту з адресою станції замість вашої квартири.
- **Firewall** — охорона на в’їзді; **порти** — різні двері будинку.
- **DNS** — телефонна/адресна книга: ім’я → адреса.

---

## 12) Шпаргалка (команди)

```bash
# Адреси/маршрути
ip -br addr
ip route
ping -c4 1.1.1.1
traceroute 8.8.8.8     # або mtr 8.8.8.8

# Порти/з’єднання
ss -ltnp               # TCP‑слухачі
lsof -i -P -n          # сокети ↔ процеси

# DNS
dig +short example.com A
dig +short example.com AAAA
nslookup example.com

# Хто зайняв порт
sudo lsof -iTCP:80 -sTCP:LISTEN -n -P
```

---

> **Висновок:** розуміння IP, підмереж, шлюзів, NAT, портів, firewall і DNS — база для роботи з Linux‑серверами та усунення мережевих збоїв. Практикуйтеся з `ip`, `ss`, `dig`, `lsof`, `ping` і ви швидко навчитеся «бачити» мережу як систему взаємопов’язаних рівнів.
