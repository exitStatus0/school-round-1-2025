# Лекція: **Дозволи на файли та власність у Linux (rwx, chown, chmod)**

> Усе в Linux — **файли**. Тут розберемо, як працюють **власники** (user/group) та **дозволи** (`rwx`) для файлів і каталогів, як їх переглядати (`ls -l`) і змінювати (`chmod`, `chown`, `chgrp`). У всіх прикладах використовуємо користувача **Гаррі** і групу **гріффіндор**.

---

## Навчальні цілі
Після лекції ви зможете:
- Читати вихід `ls -l` і розуміти **типи** та **права** файлів/каталогів.
- Пояснювати різницю між **власником‑користувачем** і **власником‑групою**.
- Змінювати власність (`chown`, `chgrp`) і дозволи (`chmod`) у **символьному** та **числовому** форматах.
- Знати специфіку прав для **каталогів** (що означає `x` тощо).
- Практично застосовувати безпечні шаблони прав (`640`, `750`, тощо).

---

## План лекції
1. Перегляд дозволів: `ls -l`, приховані файли `-a`
2. Власність файлів: користувач і група
3. Зміна власності: `chown`, `chgrp`
4. Блоки прав і тип файлу: `-`/`d` + `rwx`
5. Категорії: **user / group / others**
6. Зміна прав: `chmod` (символьний та числовий режими)
7. Практикум (10–20 хв)
8. Поширені помилки та поради
9. Контрольні питання
10. Аналогія «Будинок і кімнати»
11. Короткий довідник

---

## 1) Перегляд дозволів (`ls -l`)

Показати деталі (тип, права, власники, розмір, дату):
```bash
ls -l
```

Показати **включно з прихованими** (`.` на початку):  
```bash
ls -al        # або: ls -l -a
```

Приклад рядка виводу:
```
-rw-r----- 1 Гаррі гріффіндор 1234 Sep  1 10:00 notes.txt
drwxr-x--- 2 Гаррі гріффіндор 4096 Sep  1 10:00 reports
^--------^   ^^^^ ^^^^^^^^^^
права       user  group
```

---

## 2) Власність файлів

Кожен об’єкт має **двох власників**:
- **Користувач‑власник (user)** — зазвичай той, хто створив файл (напр., **Гаррі**).
- **Група‑власник (group)** — основна група автора під час створення (напр., **гріффіндор**).

Системні файли часто належать `root:root` — їх створила система.

---

## 3) Зміна власності

> Потрібні права адміністратора (`sudo`).

**Змінити користувача й групу одразу:**
```bash
sudo chown Гаррі:гріффіндор test.txt
```

**Змінити лише користувача:**
```bash
sudo chown Гаррі test.txt
```

**Змінити лише групу:**
```bash
sudo chgrp гріффіндор test.txt
```

**Рекурсивно для каталогу:**
```bash
sudo chown -R Гаррі:гріффіндор /srv/project
sudo chgrp -R гріффіндор /srv/project
```

---

## 4) Блоки прав і типи (`rwx`)

Перший символ — **тип**:
- `-` — звичайний файл,
- `d` — каталог,
- (інші: `l` — symlink, `c/b` — спецфайли пристроїв тощо).

Далі три трійки: `rwx` для **user** / **group** / **others**.  
- `r` (*read*) — читати файл / **список** каталогу,
- `w` (*write*) — змінювати файл / **створювати/видаляти** у каталозі,
- `x` (*execute*) — виконувати файл / **заходити** в каталог (`cd`).

> Для **каталогу** `x` означає «дозволити вхід/траверс», а `r` — «бачити список вмісту». Для повноцінної роботи з каталогом зазвичай потрібні **`r+x`** (і часто `w`).

---

## 5) Категорії користувачів

- **user** — власник‑користувач (тут: **Гаррі**),
- **group** — власник‑група (тут: **гріффіндор**),
- **others** — усі інші в системі.

Приклад:  
`-rw-r-----` → `rw-` (user) / `r--` (group) / `---` (others).

---

## 6) Зміна прав (`chmod`)

### а) **Символьний режим**
Кого змінюємо: `u` (user), `g` (group), `o` (others), `a` (усі).  
Дія: `+` (додати), `-` (зняти), `=` (встановити точно).

```bash
sudo chmod -x script.sh          # забрати 'x' у всіх (еквів. a-x)
sudo chmod g-w report.pdf        # забрати 'w' у групи (гріффіндор)
sudo chmod u+x script.sh         # додати виконання для власника (Гаррі)
sudo chmod o+r readme.txt        # читання для інших
sudo chmod g=rwx shared          # для групи рівно rwx (перезапис)
sudo chmod ug+rw,o-r secrets.txt # комбінації для кількох категорій
```

### б) **Числовий (вісімковий) режим**
Кодування: `r=4`, `w=2`, `x=1`. Складаємо для **user / group / others**.

```bash
sudo chmod 777 file      # rwx rwx rwx (НЕбажано для продакшну)
sudo chmod 750 app/      # rwx r-x --- (власник повний; група читає/виконує; інші — ні)
sudo chmod 644 notes.txt # rw- r-- r-- (типово для текстових файлів)
```

### в) **Повний перезапис блоку**
```bash
chmod g=rwx shared_dir
```

> Порада: Для спільних робочих тек корисно:
```bash
sudo chown -R Гаррі:гріффіндор /srv/shared
sudo chmod -R 770 /srv/shared
sudo chmod g+s /srv/shared        # setgid: нові файли/теки успадковують групу каталогу
```

---

## 7) Практикум (10–20 хв)

1. **Створити структуру й перевірити права**
   ```bash
   mkdir -p ~/perm-demo/{docs,bin}
   touch ~/perm-demo/docs/notes.txt
   touch ~/perm-demo/bin/run.sh
   ls -l ~/perm-demo ~/perm-demo/docs ~/perm-demo/bin
   ```
2. **Налаштувати власність на себе/групу**
   ```bash
   sudo chown -R Гаррі:гріффіндор ~/perm-demo
   ls -l ~/perm-demo/docs/notes.txt
   ```
3. **Зробити скрипт виконуваним, а каталоги — доступними для групи**
   ```bash
   chmod u+x ~/perm-demo/bin/run.sh
   chmod 750 ~/perm-demo ~/perm-demo/docs ~/perm-demo/bin
   ```
4. **Встановити політику для спільної роботи групи**
   ```bash
   chmod -R 770 ~/perm-demo/docs
   chmod g+s ~/perm-demo/docs
   ```
5. **Перевірити підсумок**
   ```bash
   ls -ld ~/perm-demo ~/perm-demo/docs
   ls -l  ~/perm-demo/bin/run.sh
   ```

> *Результат:* розумієте вивід `ls -l`, умієте змінювати власників і права, знаєте відмінності для файлів/каталогів.

---

## 8) Поширені помилки та поради

- **Відсутній `x` на каталозі** → навіть з `r` не зможете зайти (`cd`). Додайте `x`.
- **Надто відкриті права (`777`)** → безпекові ризики. Використовуйте мінімально необхідні.
- **Забули `-R`** для дерев → права/власність не застосувалися рекурсивно.
- **Плутаєте права файлів і каталогів** — пам’ятайте різницю значень `r/w/x`.
- **Не той власник/група** → сервіс не стартує або не пише логи. Перевіряйте `ls -l` і `journalctl`.

---

## 9) Контрольні питання

1. Що означають `r/w/x` для **файлу** та для **каталогу**?
2. Хто такі **user/group/others** у виході `ls -l`?
3. Чим відрізняється `chown` від `chgrp`?
4. Як додати право виконання **лише** власнику файлу (Гаррі)?
5. Яка різниця між `chmod 644` і `chmod 640`?
6. Навіщо `g+s` на спільній теці **гріффіндор**?

---

## 10) Аналогія: «Будинок і кімнати»

- `ls -l` — табличка біля дверей із власниками й правилами.
- **Власник‑користувач** — ви (**Гаррі**), **власник‑група** — ваша «родина» (**гріффіндор**).
- **Інші** — усі відвідувачі.
- `r` — можна **зазирнути**, `w` — **переставити меблі**, `x` — **зайти всередину** (для папки) або «запустити пристрій» (для файлу).
- `chmod` — зміна правил; `chown/chgrp` — зміна власників.

---

## 11) Короткий довідник

```bash
# Перегляд
ls -l            # довгий формат
ls -al           # з прихованими

# Власність
sudo chown Гаррі:гріффіндор path
sudo chgrp гріффіндор path
sudo chown -R Гаррі:гріффіндор dir/

# Права (символьно)
chmod u+x file
chmod g-w file
chmod a-rwx file
chmod ug+rw,o-r file

# Права (цифрами)
chmod 644 file   # rw- r-- r--
chmod 750 dir    # rwx r-x ---
chmod 770 dir    # rwx rwx ---

# Каталоги для групи
chmod g+s shared_dir   # setgid: успадкування групи
```

---

> **Короткий підсумок:** Читайте `ls -l`, розрізняйте **власника‑користувача** та **власника‑групу**, керуйте правами через `chmod` (символьно/цифрами). Для каталогів не забувайте про значення `x`. Використовуйте групу **гріффіндор** для спільної роботи — і правильні права зроблять доступ безпечним і передбачуваним.
