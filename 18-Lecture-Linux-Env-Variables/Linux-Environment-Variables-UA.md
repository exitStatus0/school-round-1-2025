# Лекція: **Змінні середовища в Linux (ENV): що це, як дивитись і керувати**

> У цій лекції розберемо **змінні середовища** — ключовий механізм конфігурації користувача й системи. Навчимося їх переглядати, створювати, робити постійними, змінювати `PATH` і безпечно використовувати в застосунках та скриптах.

---

## Навчальні цілі
Після лекції ви зможете:
- Пояснити, що таке **ENV‑змінні** й чим вони відрізняються від звичайних bash‑змінних.
- Переглядати й фільтрувати середовище: `printenv`, `env`, `grep`, `less`.
- Створювати тимчасові та **постійні** змінні (`~/.bashrc`, `/etc/environment`) і **видаляти** їх (`unset`).
- Розуміти **успадкування** середовища дочірніми процесами.
- Правильно змінювати **`PATH`**, додавати власні каталоги зі скриптами.
- Використовувати ENV‑змінні для конфігурації застосунків (секрети, URL, режими).

---

## План лекції
1. Що таке змінні середовища
2. Як подивитись і звертатись до змінних
3. Поширені змінні: `USER`, `HOME`, `SHELL`, `EDITOR`, `PATH`, `LANG`
4. Власні змінні: створення, експорт, видалення
5. **Постійні** змінні: `~/.bashrc`, `~/.profile`, `/etc/environment`
6. `PATH`: пошук команд, порядок, ризики та поради
7. Успадкування середовища та запуск команд з модифікованим ENV
8. Практикум (15–25 хв)
9. Поширені помилки та безпека
10. Контрольні питання
11. Аналогія «Офіс і нотатки»
12. Шпаргалка

---

## 1) Що таке змінні середовища

- **ENV‑змінні** — пари **ключ=значення**, які описують налаштування користувача/системи.
- Доступні **в усьому процесному дереві** поточного shell’а (успадковуються дочірніми процесами).
- Імена зазвичай у **ВЕЛИКИХ ЛІТЕРАХ** з підкресленням: `HOME`, `DB_USERNAME`.
- **Динамічні**: ОС задає базові значення, користувач/скрипти можуть змінювати під себе.

Відмінність від простої bash‑змінної: звичайна змінна **локальна для shell’а**; ENV‑змінна — **експортована** й доступна дочірнім процесам.

---

## 2) Як подивитись і звертатись до змінних

Перегляд **усього** середовища:
```bash
printenv | less
env | less
```

Пошук/фільтр:
```bash
printenv | grep -i "path"
```

Окрема змінна:
```bash
printenv USER
echo "$HOME"
```

Використання в командах/скриптах — як і звичайних bash‑змінних: `"$VAR"`.

---

## 3) Поширені змінні

- **`USER`** — ім’я поточного користувача.
- **`HOME`** — домашній каталог (напр., `/home/{userName}`).
- **`SHELL`** — оболонка за замовчуванням (напр., `/bin/bash`, `/usr/bin/zsh`).
- **`EDITOR`** — редактор за замовчуванням (напр., `vim`, `nano`).
- **`PATH`** — список каталогів (розділених `:`), де шукаються виконувані файли.
- **`LANG`/`LC_*`** — мова/локаль; впливають на сортування, формат дат тощо.
- **`PWD`** — поточний каталог; **`OLDPWD`** — попередній.

---

## 4) Власні змінні: створення, експорт, видалення

### Тимчасово (лише в поточній сесії)
```bash
DB_USERNAME="my_app_user"         # звичайна змінна shell
export DB_USERNAME                # зробити її «середовищем»
# або одним рядком:
export DB_PASSWORD="s3cr3t"
```

> Після закриття термінала ці значення зникнуть.

### Видалити/скасувати
```bash
unset DB_PASSWORD                 # прибирає змінну з поточної сесії
export -n DB_USERNAME             # скасувати «експортність» (залишити як shell-змінну)
```

### Перепризначити
```bash
DB_NAME="app_db_new"
export DB_NAME
```

---

## 5) Постійні змінні

### Для **користувача** (bash)
Додайте в `~/.bashrc`:
```bash
export DB_USERNAME="my_user"
export DB_URL="postgres://localhost:5432/app"
```
Потім перезавантажте конфіг:
```bash
source ~/.bashrc    # або відкрийте новий термінал
```

> Для `zsh` — використовуйте `~/.zshrc`.  
> **Login vs interactive shell**: у деяких системах змінні корисно ставити в `~/.profile`/`~/.bash_profile` (для login‑сесій).

### Для **всієї системи** (всі користувачі)
- Файл **`/etc/environment`** (тільки `KEY=VALUE`, **без** bash‑синтаксису і підстановок):
  ```
  DB_HOST=db.internal
  APP_ENV=prod
  ```
- Або скрипти в `/etc/profile.d/*.sh` (виконуються для login‑shell).

> Для служб **systemd**: у unit‑файлах `Environment=` або `EnvironmentFile=`.

---

## 6) `PATH`: механіка та поради

`PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:...`  
Пошук йде **зліва направо** — перша знайдена команда й виконується.

Додати власний каталог зі скриптами користувача:
```bash
mkdir -p "$HOME/bin"
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

> Поради безпеки:
> - Не ставте **`.`** (поточний каталог) на початок `PATH` — ризик підміни команд.
> - Контролюйте порядок директорій: бажані шляхи ставте **ліворуч**.
> - Перевіряйте, яку команду викликаєте: `type -a cmd`, `command -v cmd`.

---

## 7) Успадкування та запуск з модифікованим середовищем

- Дочірні процеси **успадковують** ENV батьківського shell’а; назад — ні.
- Одноразово для однієї команди:
  ```bash
  APP_ENV=prod DB_URL="postgres://..." ./run.sh
  ```
- Запустити з **чистим** середовищем:
  ```bash
  env -i PATH="/usr/bin:/bin" ./script.sh
  ```

---

## 8) Практикум (15–25 хв)

1) **Оглянути середовище**
```bash
printenv | less
printenv | grep -E '^(USER|HOME|SHELL|PATH)='
```

2) **Створити й використати власні змінні**
```bash
export API_TOKEN="tok_123"
echo "Мій токен: $API_TOKEN"
unset API_TOKEN
```

3) **Зробити постійним**
```bash
echo 'export FAVORITE_EDITOR="nano"' >> ~/.bashrc
source ~/.bashrc
echo "$FAVORITE_EDITOR"
```

4) **Додати скрипт у PATH**
```bash
mkdir -p "$HOME/bin"
cat > "$HOME/bin/hello" <<'SH'
#!/usr/bin/env bash
echo "Привіт з $0"
SH
chmod +x "$HOME/bin/hello"
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
hello
```

---

## 9) Поширені помилки та безпека

- **Плутають** звичайну змінну та ENV: без `export` дочірні процеси її **не бачать**.
- Редагування **`/etc/environment`** shell‑синтаксисом (наприклад, `"$HOME"`): там працює **лише** `KEY=VALUE`.
- Зберігання **секретів у bash‑історії**/репозиторії: використовуйте менеджери секретів або `.env`‑файли з правильними правами (`chmod 600`) і **не додавайте їх у Git**.
- Неправильний `PATH`: дублі, «крапка» на початку, випадкове затертя `PATH="..."` без старих значень.
- Зміни у `~/.bashrc` без `source` → не застосовані до поточної сесії.

---

## 10) Контрольні питання

1. Чим ENV‑змінна відрізняється від звичайної bash‑змінної?
2. Як переглянути значення `HOME` і повний список ENV‑змінних?
3. Як зробити змінну **постійною** для користувача? А для всієї системи?
4. Як **одноразово** передати змінні тільки для однієї команди?
5. Що таке `PATH` і як безпечно додати `$HOME/bin` на початок пошуку?
6. Чому небезпечно мати `.` на початку `PATH`?

---

## 11) Аналогія: «Офіс і нотатки»

- **ENV‑змінні** — ваші **особисті нотатки** і налаштування робочого місця.
- `printenv` — «швидкий огляд столу».
- Тимчасові `export` — стікери на моніторі (діють до кінця дня/сесії).
- `~/.bashrc` — **щоденник/органайзер** (залишається після перезавантаження).
- `source ~/.bashrc` — «перечитати щоденник зранку».
- `PATH` — **мапа офісу** з розташуванням інструментів; не давайте сумнівним речам опинятися попереду в списку.

---

## 12) Шпаргалка

```bash
# Перегляд
printenv                # або: env
printenv VAR            # значення конкретної змінної

# Створення (сесія)
VAR=value
export VAR              # зробити «середовищем»
export VAR=value        # коротко

# Видалення / скасування експорту
unset VAR
export -n VAR

# Постійно (bash)
echo 'export VAR="value"' >> ~/.bashrc
source ~/.bashrc

# PATH
echo 'export PATH="$HOME/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# Одноразово для команди
APP_ENV=prod DB_URL=postgres://... ./run.sh

# Чисте середовище
env -i PATH="/usr/bin:/bin" ./script.sh
```

---

> **Висновок:** Змінні середовища — універсальний спосіб керувати конфігураціями та секретами різних середовищ (dev/test/prod). Освойте `printenv`, `export`, `unset`, `PATH` і правила **постійності** — й налаштування стануть передбачуваними, безпечними та портативними.
