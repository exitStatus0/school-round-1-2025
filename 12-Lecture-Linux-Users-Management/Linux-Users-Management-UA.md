# Лекція: **Користувачі, групи та дозволи в Linux**

> У цій лекції розбираємо категорії користувачів (root, звичайні, сервісні), групи, модель прав доступу (власник/група/інші та `rwx`), а також практику створення користувачів/груп, делегування прав через `sudo`, зміну власників і режимів доступу. Приклади використовують плейсхолдер `{userName}` для домашнього каталогу користувача.

---

## Навчальні цілі
Після лекції ви зможете:
- Пояснити різницю між **root**, **звичайними** та **сервісними** користувачами.
- Створювати/видаляти **користувачів** і **групи**, керувати членством (`adduser`, `addgroup`, `usermod`, `gpasswd`).
- Розуміти та застосовувати **модель дозволів** (`rwx` для owner/group/others) через `chmod`, `chown`, `chgrp`.
- Делегувати адміністративні дії через **`sudo`** і безпечно керувати доступом.
- Використовувати **групи** як рекомендований спосіб керування правами в команді.
- Практично перевіряти, які групи має користувач, і які права має файл/каталог.

---

## План лекції
1. Категорії користувачів у Linux
2. Чому кілька облікових записів важливі (особливо на серверах)
3. Порівняння підходів Windows vs Linux (централізація облікових записів)
4. Керування дозволами напряму vs через групи
5. Практика: створення користувачів/груп і базові команди
6. Модель прав доступу до файлів і каталогів
7. Делегування через `sudo`
8. Практикум (20–30 хв)
9. Поширені помилки та поради
10. Контрольні питання
11. Аналогія «Організація та відділи»
12. Глосарій

---

## 1) Категорії користувачів у Linux

- **Root (суперкористувач)** — UID `0`, повний контроль над системою. Використовується **лише** для адмін‑завдань.
- **Звичайні користувачі** — призначені для щоденної роботи. Домашні каталоги в **`/home/<ім’я>`**, напр.: `/home/{userName}`.
- **Сервісні користувачі** — окремі аккаунти, під якими працюють сервіси (БД, веб‑сервери тощо) для **ізоляції** та безпеки. **Ніколи** не запускайте сервіси від `root` без потреби.

> На одній машині — один `root`, але багато звичайних і сервісних користувачів.

---

## 2) Навіщо кілька облікових записів (особливо на серверах)?

- **Безпека:** не діліться паролем `root`. Працюйте під звичайним користувачем і піднімайте права **точково** через `sudo`.
- **Керованість прав:** гнучкі ролі для різних людей/команд.
- **Відстежуваність:** логування дій за конкретним користувачем спрощує аудит і розслідування інцидентів.

---

## 3) Windows vs Linux: централізація облікових записів

- **Windows (Active Directory/домени)** — централізоване керування користувачами, роумінгові профілі.
- **Linux (типово)** — локальні користувачі на кожній машині. Централізація можлива через LDAP/SSSD/FreeIPA/AD‑integration, але це **не вбудовано за замовчуванням** у дистрибутиви.

---

## 4) Керування дозволами: напряму vs через групи

- Можна призначати права **безпосередньо користувачам**, але **рекомендовано** робити це через **групи**.
- **Переваги груп:** зручність, масштабованість, гнучкість. Користувач може бути членом **декількох груп** і успадковувати їхні дозволи.

---

## 5) Практика: користувачі та групи

### Де зберігаються облікові записи
```bash
cat /etc/passwd     # список користувачів
cat /etc/group      # список груп
cat /etc/shadow     # хеші паролів (доступний лише root)
```
`/etc/passwd` (полями через `:`): **username:x:UID:GID:опис:home:shell**. UID `0` — `root`.

### Створення користувача
```bash
sudo adduser harry                # інтерактивне створення, пароль, /home/harry, група harry
sudo passwd harry                 # змінити (або задати) пароль
```
> `adduser` (в Ubuntu/Debian) — дружній фронт‑енд до `useradd`. Для скриптів: `useradd` з потрібними опціями.

### Перемикання користувачів
```bash
su - harry       # увійти як harry (завантажить середовище), потрібен пароль harry
su -             # увійти як root (потрібен пароль root, якщо дозволено)
exit             # вийти з поточної сесії користувача
```

### Створення/перевірка груп
```bash
sudo addgroup griffindor
grep griffindor /etc/group
```

### Додати користувача до груп
```bash
sudo usermod -aG griffindor harry # додати до вторинної групи (правильно: -aG)
groups harry                      # перевірити членство
```
> **Обережно:** `usermod -G` **без** `-a` **перезаписує** увесь список вторинних груп.

### Змінити основну групу/видалити групу
```bash
sudo usermod -g griffindor harry  # змінити основну групу
sudo gpasswd -d harry griffindor  # видалити harry із групи griffindor
sudo delgroup griffindor          # видалити групу (якщо порожня)
```

### Видалення користувача
```bash
sudo deluser harry
# або з домашнім каталогом:
sudo deluser --remove-home harry
```

### Сервісний користувач (системний)
```bash
sudo useradd --system --home /var/lib/myapp --shell /usr/sbin/nologin --user-group myapp
```

---

## 6) Модель прав доступу до файлів і каталогів

Кожен об’єкт має **власника (user)**, **групу (group)** та права для **інших (others)**. Права — це `r` (читання), `w` (запис), `x` (виконання).

Перегляд прав:
```bash
ls -l
# -rw-r----- 1 harry griffindor  1234 Sep  1 10:00 notes.txt
# drwxr-x--- 2 harry griffindor  4096 Sep  1 10:00 reports/
```

Зміна власника/групи:
```bash
sudo chown harry:griffindor notes.txt
sudo chgrp griffindor reports/
sudo chown -R harry:griffindor /srv/project
```

Зміна прав (`chmod`):
```bash
chmod u+rw,g+r,o- notes.txt      # символічний запис
chmod 640 notes.txt              # числовий (u=6,g=4,o=0)
chmod -R 750 reports/            # рекурсивно для каталогу
```

Додаткові біти:
```bash
chmod g+s shared/    # setgid на каталозі: нові файли успадковують групу каталогу
chmod +t /tmp        # sticky bit: видаляти файли можуть лише власники (типово на /tmp)
# setuid/setgid на виконуваних файлах використовуються обережно з міркувань безпеки
```

`umask` визначає **маску за замовчуванням** для нових файлів/тек (типово 022/002 залежно від політик).

---

## 7) Делегування через `sudo`

Додати користувача до групи `sudo` (Ubuntu) або `wheel` (RHEL/Fedora):
```bash
sudo usermod -aG sudo harry  # або wheel
```

Редагувати політики безпечно через **`visudo`** (перевіряє синтаксис) і фрагменти в `/etc/sudoers.d/`:
```
harry ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart nginx
```
> Дозвольте **тільки потрібні команди**; уникайте blanket‑прав типу `ALL` без потреби.

---

## 8) Практикум (20–30 хв)

1. **Огляд системних користувачів/груп**
   ```bash
   head -n 5 /etc/passwd
   head -n 5 /etc/group
   ```
2. **Створити користувача та групу**
   ```bash
   sudo adduser {userName}
   sudo addgroup griffindor
   sudo usermod -aG griffindor {userName}
   groups {userName}
   ```
3. **Налаштувати права на каталог проєкту**
   ```bash
   sudo mkdir -p /srv/app/{conf,logs}
   sudo chown -R {userName}:griffindor /srv/app
   sudo chmod -R 750 /srv/app
   sudo chmod g+s /srv/app/logs
   ```
4. **Перевірити доступи**
   ```bash
   ls -l /srv/app
   sudo -u {userName} touch /srv/app/logs/test.log
   ```
5. **Делегувати дію через sudoers (демо)**
   ```bash
   sudo visudo   # додайте правило для безпарольного рестарту сервісу (на тестовій машині)
   ```

> *Результат:* вмієте створювати користувачів/групи, призначати права на файли/теки та безпечно делегувати адмін‑дії.

---

## 9) Поширені помилки та поради

- Використання `usermod -G` без `-a` → **втрата** попередніх груп.
- Запуск сервісів від `root` без потреби → **ризик безпеці**.
- Надмірні правила в `sudoers` (`ALL` без обмежень) → **привілейована ескалація**.
- Забули рекурсію `-R` для каталогів у `chown/chmod`.
- Невірні права на каталоги: для каталогів потрібен `x`, інакше не можна «зайти» всередину.
- Правильність власника/групи логів/даних сервісу — часта причина збоїв після деплою.

---

## 10) Контрольні питання

1. Чим відрізняються root, звичайні та сервісні користувачі?
2. Чому дозволи краще керувати через **групи**?
3. Що робить `usermod -aG` і чому не можна забувати `-a`?
4. Як змінити власника/групу і права файлу? Наведіть приклад.
5. Для чого `setgid` на каталозі і `sticky bit` на `/tmp`?
6. Як безпечно надавати привілеї через `sudo`? Де редагуються правила?

---

## 11) Аналогія: «Організація та відділи»

- **Директор (root)** має повні повноваження.
- **Працівники (звичайні користувачі)** працюють у своїх «кабінетах» — домашніх каталогах.
- **Службові роботи (сервісні користувачі)** виконують вузькі задачі лише з потрібними правами.
- **Відділи (групи)** отримують доступи до ресурсів; додавання/видалення працівника з відділу миттєво змінює його дозволи.
- **`sudo`** — тимчасовий підпис директора на конкретну дію.

---

## 12) Глосарій

- **UID/GID** — ідентифікатори користувача/групи.
- **`/etc/passwd`, `/etc/group`, `/etc/shadow`** — базові файли облікових записів.
- **`adduser`/`useradd`, `addgroup`/`groupadd`** — інструменти створення.
- **`usermod`, `gpasswd`** — керування членством/властивостями.
- **`chown`, `chgrp`, `chmod`** — власники/групи/права.
- **`sudo`, `visudo`, `sudoers`** — делегування привілеїв.
- **`setgid`, `sticky bit`, `umask`** — додаткові механізми керування доступом.

---

> **Короткий підсумок:** Використовуйте **групи** для масштабованого керування дозволами, **`sudo`** — для точкових адмін‑дій, а сервісні користувачі з мінімальними правами підвищують безпеку. Розуміння `rwx`‑моделі та базових команд — фундамент адміністрування Linux.
